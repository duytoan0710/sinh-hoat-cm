<div class="relative">
  <label class="block text-sm font-medium leading-6 text-gray-900">{{ label() }}</label>
  <div class="mt-2">
    <div (click)="toggleDropdown()" class="flex flex-wrap gap-2 items-center p-2 min-h-[40px] w-full rounded-md border-0 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-indigo-600 cursor-text">
      @for(item of selectedItems(); track item) {
        <span class="inline-flex items-center rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-700/10">
          {{ item }}
          <button type="button" (click)="$event.stopPropagation(); removeItem(item)" class="ml-1.5 inline-flex text-indigo-500 hover:text-indigo-700 focus:outline-none">
            <svg class="h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg>
          </button>
        </span>
      }
      @if(selectedItems().length === 0 && !isOpen()) {
        <span class="text-gray-400 pl-1">Chọn thành viên...</span>
      }
    </div>
  </div>

  @if (isOpen()) {
    <div class="absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-60 overflow-y-auto">
      <div class="p-2">
        <input 
          type="text"
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
          placeholder="Tìm kiếm..."
          class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm"
          (click)="$event.stopPropagation()"
          autofocus>
      </div>
      <ul class="py-1">
        @for(option of filteredOptions; track option) {
          <li (click)="selectItem(option)" class="text-gray-900 relative cursor-pointer select-none py-2 px-4 hover:bg-indigo-600 hover:text-white">
            <span class="block truncate">{{ option }}</span>
          </li>
        } @empty {
           <li class="text-gray-500 relative cursor-default select-none py-2 px-4">
            <span class="block truncate">Không tìm thấy kết quả</span>
          </li>
        }
      </ul>
    </div>
  }
</div>